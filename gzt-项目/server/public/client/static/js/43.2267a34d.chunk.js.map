{"version":3,"sources":["components/braftEditor/index.tsx","pages/work/review/exportPreview.tsx"],"names":["braft_editor__WEBPACK_IMPORTED_MODULE_0__","__webpack_require__","braft_editor__WEBPACK_IMPORTED_MODULE_0___default","n","BraftEditor","ExportPreview","state","template","reportValue","undefined","visible","handleExport","_callee","result","blobUrl","a","_Users_litong_laravel_gzt_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_12___default","wrap","_context","prev","next","request","getFile","method","body","Object","_Users_litong_laravel_gzt_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_15__","_this","text","toHTML","sent","window","URL","createObjectURL","blob","document","createElement","download","decodeURI","headers","get","href","click","revokeObjectURL","antd_es_message__WEBPACK_IMPORTED_MODULE_14__","info","stop","handlePrint","printf","getElementById","html","concat","contentDocument","write","close","contentWindow","print","preview","setState","_this2","this","props","location","_this$props$location$","pst_id","temId","report_id","_Users_litong_laravel_gzt_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_16__","mark","_callee2","_context2","params","status","data","createEditorState","_this3","_this$state","react__WEBPACK_IMPORTED_MODULE_22__","antd_es_layout__WEBPACK_IMPORTED_MODULE_1__","className","style","marginBottom","padding","height","lineHeight","border","onClick","history","goBack","antd_es_icon__WEBPACK_IMPORTED_MODULE_11__","type","antd_es_row__WEBPACK_IMPORTED_MODULE_5__","antd_es_col__WEBPACK_IMPORTED_MODULE_7__","span","paddingRight","antd_es_button__WEBPACK_IMPORTED_MODULE_9__","width","_components_braftEditor__WEBPACK_IMPORTED_MODULE_24__","value","controls","onChange","EditorState","antd_es_modal__WEBPACK_IMPORTED_MODULE_3__","title","footer","onCancel","dangerouslySetInnerHTML","__html","id","src","frameBorder","React"],"mappings":"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","file":"static/js/43.2267a34d.chunk.js","sourcesContent":["import BraftEditor from 'braft-editor';\nimport 'braft-editor/dist/index.css'\nimport './index.scss'\n\n/**\n * 包裹原生的BraftEditor组件，为了统一样式\n * 一些对编辑器本身的改造也可以放在这里\n */\nexport default BraftEditor;","import * as React from 'react';\nimport { History, Location } from 'history';\nimport { Layout, Icon, Row, Col, Button, message, Modal } from 'antd';\nimport request, { get } from '../../../utils/request';\nimport BraftEditor from '../../../components/braftEditor';\nimport { ControlType } from 'braft-editor';\nimport './exportPreview.scss';\n\nexport interface ExportPreviewProps {\n  location: Location;\n  history: History;\n}\n\nclass ExportPreview extends React.Component<ExportPreviewProps, any> {\n\n  state = {\n    template: {},\n    reportValue: undefined,\n    visible: false\n  }\n\n  componentDidMount() {\n    if (this.props.location.state) {\n      const { pst_id, report_id: temId } = this.props.location.state;\n      (async () => {\n        const result = await get('/api/c_pst_getReplacedVarTemplate', {\n          params: {\n            pst_id,\n            temId\n          }\n        })\n        if (result.status === 'success') {\n          this.setState({\n            template: result.data,\n            reportValue: BraftEditor.createEditorState(result.data.text)\n          })\n        }\n      })()\n    }\n  }\n  /** 导出 */\n  handleExport = async () => {\n    const result = await request('/api/c_pst_exportSingleTemplatePackage', {\n      getFile: true,\n      method: 'POST',\n      body: {\n        ...this.state.template,\n        text: (this.state.reportValue as any).toHTML()\n      }\n    })\n    let blobUrl = window.URL.createObjectURL(result.blob);\n    const a = document.createElement('a');\n    a.download = decodeURI(result.headers.get('filename'));//获取文件名\n    a.href = blobUrl;\n    a.click();\n    window.URL.revokeObjectURL(blobUrl);\n    message.info('导出成功');\n  }\n  /** 处理打印 */\n  handlePrint = () => {\n    //   <head>\n    //   <style>\n    //   p {page-break-after: always}\n    //   </style>\n    //    <head>\n    const printf = (document.getElementById('print') as any);\n    const html = `\n    <body>${(this.state.reportValue as any).toHTML()}</body>\n    `\n    printf.contentDocument.write(html);\n    printf.contentDocument.close();\n    printf.contentWindow.print();\n  }\n  /** 预览 */\n  preview = () => {\n    this.setState({\n      visible: true\n    })\n  }\n  render() {\n\n    const { reportValue, visible } = this.state;\n    const controls: ControlType[] = [\n      'undo', 'redo', 'remove-styles',\n      'separator',\n      'headings', 'font-size', 'font-family', 'separator',\n      'bold', 'italic', 'underline', 'text-color', 'separator',\n      'list-ul', 'list-ol', 'text-indent', 'text-align', 'separator',\n      'superscript', 'subscript', 'media', 'fullscreen'\n    ];\n\n    return (\n      <Layout className=\"review-export-preview\" >\n        <div style={{ marginBottom: 24, padding: '0 20px', height: '56px', lineHeight: '56px', border: '1px solid #eee' }}>\n          <span className=\"goback\" onClick={() => this.props.history.goBack()}>\n            <Icon type=\"arrow-left\" />返回\n          </span>\n        </div>\n        <Row>\n          <Col span={4} className=\"text-right\" style={{ paddingRight: 36 }}>\n            <div style={{ marginBottom: 12 }}>\n              <Button type=\"primary\" style={{ width: 160 }} onClick={this.handleExport}>下载</Button>\n            </div>\n            <div style={{ marginBottom: 12 }}><Button type=\"primary\" style={{ width: 160 }} onClick={this.preview}>预览</Button></div>\n            <div style={{ marginBottom: 12 }}>\n              <Button type=\"primary\" style={{ width: 160 }} onClick={this.handlePrint}>打印</Button>\n            </div>\n          </Col>\n          <Col span={20}>\n            <BraftEditor\n              className=\"create-report\"\n              value={reportValue}\n              controls={controls}\n              onChange={(EditorState) => this.setState({ reportValue: EditorState })}\n            />\n          </Col>\n        </Row>\n        <Modal\n          visible={visible}\n          title=\"预览\"\n          width={790}\n          footer={null}\n          onCancel={() => this.setState({ visible: false })}\n        >\n          <div dangerouslySetInnerHTML={{ __html: this.state.reportValue ? (this.state.reportValue as any).toHTML() : '' }} />\n        </Modal>\n        <iframe id=\"print\" src=\"\" width=\"0\" height=\"0\" frameBorder=\"0\" />\n      </Layout>\n    )\n  }\n}\nexport default ExportPreview\n"],"sourceRoot":""}