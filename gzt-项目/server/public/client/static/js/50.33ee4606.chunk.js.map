{"version":3,"sources":["pages/work/Work.tsx"],"names":["Urlmap","notice","review","approval","assist","communication","Work","connect","state","Object","_Users_litong_laravel_gzt_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_14__","permission","dispatch","showNavigation","nav","k","type","concat","payload","showTabActive","currentTab","queryCompanys","changeCompany","id","cb","queryUserPermission","props","_this","_Users_litong_laravel_gzt_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_8__","this","_Users_litong_laravel_gzt_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_10__","_Users_litong_laravel_gzt_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_11__","call","canJump","prevTab","needClear","icon","companyChange","_ref","key","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","getCachingKeys","Symbol","iterator","next","done","cacheKey","value","dropByCacheKey","err","return","cacheLifecycles","didRecover","componentDidRecover","bind","_Users_litong_laravel_gzt_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_assertThisInitialized__WEBPACK_IMPORTED_MODULE_12__","pathname","location","navigation","split","history","replace","prevProps","needJump","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","includes","setState","visible","nextIcon","_this2","_this$props","companys","enterpriseList","react__WEBPACK_IMPORTED_MODULE_15__","antd_es_menu__WEBPACK_IMPORTED_MODULE_7__","onClick","relate_companys","map","_ref2","name","Item","Divider","antd_es_layout__WEBPACK_IMPORTED_MODULE_1__","className","classnames","active","react_router_dom__WEBPACK_IMPORTED_MODULE_17__","to","style","display","padding","tab","antd_es_icon__WEBPACK_IMPORTED_MODULE_5__","cursor","antd_es_dropdown__WEBPACK_IMPORTED_MODULE_3__","overlay","trigger","placement","onVisibleChange","changeIcon","paddingRight","current_company","children","React"],"mappings":"gVAUMA,UAAS,CACbC,OAAU,CAAC,eAAgB,gBAC3BC,OAAU,CAAC,eAAgB,sBAC3BC,SAAY,CAAC,iBAAkB,gBAC/BC,OAAU,CAAC,eAAgB,gBAC3BC,cAAiB,CAAC,sBAAuB,kBAiEtBC,EADpBC,YA3DuB,SAACC,GACvB,OAAOC,OAAAC,EAAA,EAAAD,CAAA,GACFD,EAAK,UADV,CAEEG,WAAYH,EAAK,SAAWG,cAGL,SAACC,GAC1B,MAAO,CACLC,eAAgB,SAACC,EAAUC,GACzBH,EAAS,CACPI,KAAI,GAAAC,OAZM,YAYN,kBACJC,QAAS,CAAEJ,MAAKC,QAGpBI,cAAe,SAACC,GACdR,EAAS,CACPI,KAAI,GAAAC,OAlBM,YAkBN,iBACJC,QAASE,KAGbC,cAAe,WACbT,EAAS,CACPI,KAAI,GAAAC,OAxBM,YAwBN,qBAGRK,cAAe,SAACC,EAAqBC,GACnCZ,EAAS,CACPI,KAAI,GAAAC,OA7BM,YA6BN,kBACJC,QAAS,CAAEK,KAAIC,SAGnBC,oBAAqB,WACnBb,EAAS,CACPI,KAAI,GAAAC,OAlCK,WAkCL,4CAoCV,SAAAX,EAAYoB,GAAY,IAAAC,EAAA,OAAAlB,OAAAmB,EAAA,EAAAnB,CAAAoB,KAAAvB,IACtBqB,EAAAlB,OAAAqB,EAAA,EAAArB,CAAAoB,KAAApB,OAAAsB,EAAA,EAAAtB,CAAAH,GAAA0B,KAAAH,KAAMH,KARRlB,MAAQ,CACNyB,SAAS,EACTC,QAAS,GACTC,WAAW,EACXC,KAAM,cAGgBT,EA0ExBU,cAAgB,SAAAC,GAAkB,IAAfC,EAAeD,EAAfC,IACjBZ,EAAKD,MAAMJ,cAAciB,EAAK,WAAM,IAAAC,GAAA,EAAAC,GAAA,EAAAC,OAAAC,EAAA,IAElC,QAAAC,EAAAC,EAAuBC,2BAAvBC,OAAAC,cAAAR,GAAAI,EAAAC,EAAAI,QAAAC,MAAAV,GAAA,EAAyC,KAA9BW,EAA8BP,EAAAQ,MACvCC,yBAAeF,IAHiB,MAAAG,GAAAb,GAAA,EAAAC,EAAAY,EAAA,YAAAd,GAAA,MAAAK,EAAAU,QAAAV,EAAAU,SAAA,WAAAd,EAAA,MAAAC,GAKlCf,EAAKD,MAAMD,yBA7EbC,EAAM8B,gBAAgBC,WAAW9B,EAAK+B,oBAAoBC,KAAzBlD,OAAAmD,EAAA,EAAAnD,CAAAkB,KAHXA,mFAOtB,IAAMkC,EAAWhC,KAAKH,MAAMoC,SAASD,SAKrC,GAJAhC,KAAKH,MAAML,gBAIPQ,KAAKH,MAAMoC,SAAStD,MAAO,CAC7B,IAAMuD,EAAa/D,EAAO6D,EAASG,MAAM,KAAK,GAAGA,MAAM,KAAK,IACtD5C,EAAapB,EAAO6D,EAASG,MAAM,KAAK,GAAGA,MAAM,KAAK,IAAI,GAChEnC,KAAKH,MAAMP,cAAcC,GACzBS,KAAKH,MAAMb,eAAekD,OAIT,UAAbF,GAAkD,UAA1BhC,KAAKH,MAAMN,YACrCS,KAAKH,MAAMuC,QAAQC,QAAQrC,KAAKH,MAAMN,uDAKzB+C,GAajB,GAXItC,KAAKH,MAAM0C,WACTD,EAAU/C,aAAeS,KAAKH,MAAMN,WACtCS,KAAKH,MAAMuC,QAAQC,QAAQrC,KAAKH,MAAMN,YAGC,UAAhC+C,EAAUL,SAASD,UAAyD,UAAjChC,KAAKH,MAAMoC,SAASD,UAClEM,EAAU/C,aAAeS,KAAKH,MAAMN,YACtCS,KAAKH,MAAMuC,QAAQC,QAAQrC,KAAKH,MAAMN,aAIxCS,KAAKrB,MAAM2B,UAAW,KAAAkC,GAAA,EAAAC,GAAA,EAAAC,OAAA5B,EAAA,IACxB,QAAA6B,EAAAC,EAAuB3B,2BAAvBC,OAAAC,cAAAqB,GAAAG,EAAAC,EAAAxB,QAAAC,MAAAmB,GAAA,EAAyC,KAA9BlB,EAA8BqB,EAAApB,MAEvCD,EAASuB,SAAS7C,KAAKrB,MAAM0B,UAAYmB,yBAAeF,IAHlC,MAAAG,GAAAgB,GAAA,EAAAC,EAAAjB,EAAA,YAAAe,GAAA,MAAAI,EAAAlB,QAAAkB,EAAAlB,SAAA,WAAAe,EAAA,MAAAC,GAKxB1C,KAAK8C,SAAS,CACZxC,WAAW,mDAMfN,KAAKH,MAAMuC,QAAQC,QAAQrC,KAAKH,MAAMN,kDAM1BA,GACZS,KAAKH,MAAMP,cAAcC,0CAOZN,EAAeC,GAE5Bc,KAAKH,MAAMb,eAAeC,EAAKC,GAC/Bc,KAAK8C,SAAS,CACZzC,QAASpB,EAAI,GACbqB,WAAW,uCAcJyC,GACT,IAAMC,EAAWD,EAAU,WAAa,aACxC/C,KAAK8C,SAAS,CACZvC,KAAMyC,qCAID,IAAAC,EAAAjD,KAAAkD,EAEsClD,KAAKH,MAA1CqC,EAFDgB,EAEChB,WAAY3C,EAFb2D,EAEa3D,WAAY4D,EAFzBD,EAEyBC,SACxB5C,EAASP,KAAKrB,MAAd4B,KAGF6C,EACJC,EAAA,cAAAC,EAAA,GAAMC,QAASvD,KAAKQ,eAEhB2C,GAAYA,EAASK,gBAAgBC,IAAI,SAAAC,GAAA,IAAGhE,EAAHgE,EAAGhE,GAAIiE,EAAPD,EAAOC,KAAP,OACvCN,EAAA,cAAAC,EAAA,EAAMM,KAAN,CAAWlD,IAAKhB,GAAKiE,KAGzBN,EAAA,cAAAC,EAAA,EAAMO,QAAN,MACAR,EAAA,cAAAC,EAAA,EAAMM,KAAN,CAAWlD,IAAK,GAAhB,yCAGJ,OACE2C,EAAA,cAAAS,EAAA,OACET,EAAA,qBAAKU,UAAU,6BACbV,EAAA,qBAAKU,UAAWC,IAAW,CAAEC,OAAQ,UAAY1E,KAAe8D,EAAA,cAACa,EAAA,EAAD,CAAMC,GAAG,QAAQZ,QAAS,kBAAMN,EAAK3D,cAAc,UAAU8E,MAAO,CAAEC,QAAS,eAAgBC,QAAS,WAAxG,uBAE9DpC,EAAWuB,IAAI,SAACc,EAAerF,GAAhB,OACbmE,EAAA,qBAAK3C,IAAK6D,EAAI,GAAIR,UAAWC,IAAW,CAAEC,OAAQM,EAAI,KAAOhF,KAC3D8D,EAAA,cAACa,EAAA,EAAD,CAAMX,QAAS,kBAAMN,EAAK3D,cAAciF,EAAI,KAAKJ,GAAII,EAAI,GAAIH,MAAO,CAAEC,QAAS,eAAgBC,QAAS,WACrGC,EAAI,IAEPlB,EAAA,cAAAmB,EAAA,GAAMjB,QAAS,kBAAMN,EAAKjE,eAAeuF,EAAKrF,IAAIC,KAAK,QAAQiF,MAAO,CAAEE,QAAS,QAASG,OAAQ,gBAIxGpB,EAAA,cAAAqB,EAAA,GACEC,QAASvB,EACTwB,QAAS,CAAC,SACVb,UAAU,UACVc,UAAU,cACVC,gBAAiB,SAAC/B,GAAD,OAAsBE,EAAK8B,WAAWhC,KAEvDM,EAAA,sBAAMU,UAAU,oBAAoBK,MAAO,CAAEE,QAAS,SAAUG,OAAQ,YACtEpB,EAAA,sBAAMe,MAAO,CAAEY,aAAc,QAAU7B,GAAYA,EAAS8B,gBAAgBtB,KAAOR,EAAS8B,gBAAgBtB,KAAO,wCACnHN,EAAA,cAAAmB,EAAA,GAAMrF,KAAMoB,OAIjBP,KAAKH,MAAMqF,iBAhJcC","file":"static/js/50.33ee4606.chunk.js","sourcesContent":["import * as React from 'react';\nimport { Layout, Dropdown, Menu, Icon } from 'antd';\nimport { connect } from 'dva';\nimport { Link } from 'react-router-dom';\nimport classnames from 'classnames';\nimport { dropByCacheKey, getCachingKeys } from 'react-router-cache-route';\nimport { History, Location } from 'history';\nimport './work.scss';\n\n// url 映射\nconst Urlmap = {\n  \"notice\": ['/work/notice', '公告'],\n  \"review\": ['/work/review', '评审通'],\n  \"approval\": ['/work/approval', '审批'],\n  \"assist\": ['/work/assist', '协助'],\n  \"communication\": ['/work/communication', '沟通']\n}\n\nconst NAMESPACE = 'Workbench'; // dva model 命名空间\nconst USERINFO = 'UserInfo'; // dva model 命名空间\nconst mapStateToProps = (state: any) => {\n  return {\n    ...state[NAMESPACE],\n    permission: state[USERINFO].permission\n  }\n};\nconst mapDispatchToProps = (dispatch: any) => {\n  return {\n    showNavigation: (nav: any, k: number) => {\n      dispatch({\n        type: `${NAMESPACE}/setNavigation`,\n        payload: { nav, k }\n      });\n    },\n    showTabActive: (currentTab: string) => {\n      dispatch({\n        type: `${NAMESPACE}/setTabActive`,\n        payload: currentTab\n      });\n    },\n    queryCompanys: () => {\n      dispatch({\n        type: `${NAMESPACE}/queryCompanys`\n      });\n    },\n    changeCompany: (id: string | number, cb: Function) => {\n      dispatch({\n        type: `${NAMESPACE}/changeCompany`,\n        payload: { id, cb }\n      });\n    },\n    queryUserPermission: () => {\n      dispatch({\n        type: `${USERINFO}/queryUserPermission`\n      });\n    }\n  }\n}\n\ninterface WorkProps {\n  location: Location;\n  history: History;\n  /** 获取用户当前加入的所有公司列表 */\n  queryCompanys: Function;\n  companys: any;\n  /** 当前处于激活状态的 tab 标签 */\n  showTabActive: Function;\n  currentTab: any;\n  /** 是否需要跳转 */\n  needJump: boolean;\n  /** 当前导航 */\n  showNavigation: Function;\n  navigation: any[];\n  /** 切换公司 */\n  changeCompany: Function;\n  /** 重新获取用户权限 */\n  queryUserPermission: Function;\n}\n\n@connect(mapStateToProps, mapDispatchToProps)\nexport default class Work extends React.Component<WorkProps, any>{\n\n  state = {\n    canJump: false,\n    prevTab: '',\n    needClear: false,\n    icon: 'caret-down'\n  }\n\n  constructor(props: any) {\n    super(props);\n    // props.cacheLifecycles.didCache(this.componentDidCache.bind(this));\n    props.cacheLifecycles.didRecover(this.componentDidRecover.bind(this));\n  }\n\n  componentDidMount() {\n    const pathname = this.props.location.pathname;\n    this.props.queryCompanys();\n\n\n    // 如果是从其他页面跳转到工作模块的内部某个页面\n    if (this.props.location.state) {\n      const navigation = Urlmap[pathname.split('/')[2].split('-')[0]];\n      const currentTab = Urlmap[pathname.split('/')[2].split('-')[0]][0];\n      this.props.showTabActive(currentTab);\n      this.props.showNavigation(navigation);\n    } else {\n\n      // 如果直接点击顶部导航 `工作` 进入，跳转到之前打开的标签页，其他情况不用处理\n      if (pathname === '/work' && this.props.currentTab !== '/work') {\n        this.props.history.replace(this.props.currentTab);\n      }\n    }\n  }\n\n  componentDidUpdate(prevProps: any) {\n\n    if (this.props.needJump) {\n      if (prevProps.currentTab !== this.props.currentTab) {\n        this.props.history.replace(this.props.currentTab);\n      }\n      // 判断上次是工作模块下的其他页面,这次是工作台然后再跳转\n      else if (prevProps.location.pathname !== '/work' && this.props.location.pathname === '/work') {\n        if (prevProps.currentTab !== this.props.currentTab) {\n          this.props.history.replace(this.props.currentTab);\n        }\n      }\n    }\n    if (this.state.needClear) {\n      for (const cacheKey of getCachingKeys()) {\n\n        cacheKey.includes(this.state.prevTab) && dropByCacheKey(cacheKey)\n      }\n      this.setState({\n        needClear: false\n      })\n    }\n\n  }\n  componentDidRecover() {\n    this.props.history.replace(this.props.currentTab)\n  }\n  /**\n   * 设置当前处于激活状态的tab\n   * @param currentTab \n   */\n  showTabActive(currentTab: string) {\n    this.props.showTabActive(currentTab);\n  }\n  /**\n   * 设置 tab 导航\n   * @param nav 当前 tab 信息 ['path', 'name']\n   * @param k 当前点击的 tab 索引\n   */\n  showNavigation(nav: string[], k: number) {\n\n    this.props.showNavigation(nav, k);\n    this.setState({\n      prevTab: nav[0],\n      needClear: true\n    })\n  }\n  /** 切换公司 */\n  companyChange = ({ key }: any) => {\n    this.props.changeCompany(key, () => {\n      // 清除所有缓存页面\n      for (const cacheKey of getCachingKeys()) {\n        dropByCacheKey(cacheKey)\n      }\n      this.props.queryUserPermission();\n    })\n  }\n  /** 更换图标 */\n  changeIcon(visible: boolean) {\n    const nextIcon = visible ? 'caret-up' : 'caret-down';\n    this.setState({\n      icon: nextIcon\n    })\n  }\n\n  render() {\n\n    const { navigation, currentTab, companys } = this.props;\n    const { icon } = this.state;\n\n    // 公司列表\n    const enterpriseList = (\n      <Menu onClick={this.companyChange}>\n        {\n          companys && companys.relate_companys.map(({ id, name }: any) => (\n            <Menu.Item key={id}>{name}</Menu.Item>\n          ))\n        }\n        <Menu.Divider />\n        <Menu.Item key={0}>私人工作空间</Menu.Item>\n      </Menu>\n    );\n    return (\n      <Layout>\n        <div className=\"workbench-header clearfix\">\n          <div className={classnames({ active: '/work' === currentTab })}><Link to=\"/work\" onClick={() => this.showTabActive('/work')} style={{ display: 'inline-block', padding: '0 20px' }}>工作台</Link></div>\n          {\n            navigation.map((tab: string[], k: number) => (\n              <div key={tab[0]} className={classnames({ active: tab[0] === currentTab })}>\n                <Link onClick={() => this.showTabActive(tab[0])} to={tab[0]} style={{ display: 'inline-block', padding: '0 30px' }}>\n                  {tab[1]}\n                </Link>\n                <Icon onClick={() => this.showNavigation(tab, k)} type=\"close\" style={{ padding: '0 6px', cursor: 'pointer' }} />\n              </div>\n            ))\n          }\n          <Dropdown\n            overlay={enterpriseList}\n            trigger={['click']}\n            className=\"company\"\n            placement=\"bottomRight\"\n            onVisibleChange={(visible: boolean) => this.changeIcon(visible)}\n          >\n            <span className=\"ant-dropdown-link\" style={{ padding: '0 20px', cursor: 'pointer' }}>\n              <span style={{ paddingRight: '8px' }}>{companys && companys.current_company.name ? companys.current_company.name : '私人工作空间'}</span>\n              <Icon type={icon} />\n            </span>\n          </Dropdown>\n        </div>\n        {this.props.children}\n      </Layout>\n    )\n  }\n}\n"],"sourceRoot":""}