{"version":3,"sources":["pages/work/review/exportmgt/GroupSort.tsx"],"names":["GroupSort","connect","state","reportGroup","dispatch","queryReportGroup","cb","type","concat","payload","queryReportes","sortedReportWrapperEl","React","createRef","loading","queryLoading","dragulaDecorator","sortedReportWrapper","Dragula","_this","current","saveGroupSort","setState","sortJson","groupList","getElementsByClassName","i","length","dataset","Object","_Users_litong_laravel_gzt_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_16__","_Users_litong_laravel_gzt_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_12___default","a","mark","_callee","result","wrap","_context","prev","next","request","method","body","_Users_litong_laravel_gzt_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_15__","sent","status","antd_es_message__WEBPACK_IMPORTED_MODULE_14__","success","props","history","push","error","stop","_this2","this","_this3","_this$state","react__WEBPACK_IMPORTED_MODULE_22___default","createElement","antd_es_layout__WEBPACK_IMPORTED_MODULE_1__","className","antd_es_row__WEBPACK_IMPORTED_MODULE_7__","antd_es_col__WEBPACK_IMPORTED_MODULE_11__","span","antd_es_button__WEBPACK_IMPORTED_MODULE_9__","onClick","replace","style","marginLeft","antd_es_spin__WEBPACK_IMPORTED_MODULE_3__","wrapperClassName","spinning","ref","map","item","index","id","name","count","key","data-type","antd_es_icon__WEBPACK_IMPORTED_MODULE_5__","padding","color","Component"],"mappings":"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","file":"static/js/54.873b27ee.chunk.js","sourcesContent":["import React from 'react';\nimport { Row, Col, Layout, Button, Icon, message, Spin } from 'antd';\nimport Dragula from 'react-dragula';\nimport { connect } from 'dva';\nimport './groupSort.scss'\nimport request from '../../../../utils/request';\n\nexport interface GroupSortProps {\n  /** 数据 */\n  params: any;\n  history: any;\n  /** 获取模板分组列表信息 */\n  queryReportGroup: Function;\n  queryReportes: Function;\n  /** 模板分组列表 */\n  reportGroup: any[];\n}\n\nconst NAMESPACE = 'Review';\nconst mapStateToProps = (state: any) => {\n  return {\n    reportGroup: state[NAMESPACE].reportGroup\n  }\n};\nconst mapDispatchToProps = (dispatch: any) => {\n  return {\n    queryReportGroup: (cb: Function) => {\n      dispatch({\n        type: `${NAMESPACE}/queryReportGroup`,\n        payload: cb\n      });\n    },\n    /** 获取流程列表信息 (用于刷新) */\n    queryReportes: () => {\n      dispatch({\n        type: `${NAMESPACE}/queryReports`\n      });\n    }\n  }\n}\n@connect(mapStateToProps, mapDispatchToProps)\n/**\n * 分组下具体流程item\n */\nexport default class GroupSort extends React.Component<GroupSortProps, any>{\n\n  sortedReportWrapperEl: any = React.createRef();\n  state = {\n    loading: false,\n    queryLoading: false\n  }\n\n  componentDidMount() {\n\n    /** 首次请求 之后用缓存的数据 */\n    if (!this.props.reportGroup) {\n      /** 请求数据时loading */\n      this.setState({\n        queryLoading: true\n      })\n      this.props.queryReportGroup(() => {\n        this.setState({\n          queryLoading: false\n        })\n      });\n    }\n\n  }\n\n  /**\n   * 注册拖拽事件\n   * @param sortedReportWrapper 原生DOM\n   */\n  dragulaDecorator = (sortedReportWrapper: any) => {\n    if (sortedReportWrapper) {\n      Dragula([sortedReportWrapper]);\n      this.sortedReportWrapperEl.current = sortedReportWrapper;\n    }\n  }\n  /**\n   * 保存拖拽后的顺序\n   */\n  saveGroupSort = () => {\n    this.setState({\n      loading: true\n    });\n    const sortJson = {};\n    const groupList = (this.sortedReportWrapperEl.current as any).getElementsByClassName('group-item');\n    for (let i = 0; i < groupList.length; i++) {\n      sortJson[groupList[i].dataset.type] = i;\n    }\n    (async () => {\n      const result = await request('/api/c_pst_saveExportTypeSequence', {\n        method: 'POST',\n        body: {\n          ...sortJson\n        }\n      });\n      this.setState({\n        loading: false\n      });\n      if (result.status === 'success') {\n        message.success('保存成功');\n        this.props.history.push('/work/review/exportmgt');\n        this.props.queryReportes();\n        this.props.queryReportGroup();\n      } else {\n        message.error('服务器错误，请稍后再试');\n      }\n    })()\n  }\n\n  render() {\n    const { reportGroup } = this.props;\n    const { loading, queryLoading } = this.state;\n\n    return (\n      <Layout className=\"review-group-sort\" >\n        <Row className=\"group-sort-header\">\n          <Col span={4}>\n            <span className=\"group-sort-title\">评审流程分组排序</span>\n          </Col>\n          <Col span={20} className=\"text-right\">\n            <Button onClick={() => this.props.history.replace('/work/review/exportmgt')}>取消</Button>\n            <Button loading={loading} type=\"primary\" style={{ marginLeft: '30px' }} onClick={this.saveGroupSort}>保存排序</Button>\n          </Col>\n        </Row>\n        <Spin wrapperClassName=\"spin-scroll-wrapper\" spinning={queryLoading}>\n          <div ref={this.dragulaDecorator} className=\"group-sort-list\">\n            {\n              reportGroup && reportGroup.map((item: any, index: any) => {\n                const { id, name, count } = item;\n                return (\n                  <Row className=\"group-item\" key={index} data-type={id}>\n                    <Icon type=\"ordered-list\" style={{ padding: '0 10px' }} />\n                    <span>{name}</span>\n                    <span style={{ color: '#888' }}>（{count}）</span>\n                  </Row>\n                )\n              })\n            }\n\n          </div>\n        </Spin>\n      </Layout>\n    )\n  }\n}"],"sourceRoot":""}